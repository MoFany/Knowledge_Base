# Spring框架核心

## Spring中向IOC容器注入Bean的`7`中方式

>1. 使用`xml`的方式来声明`Bean`的定义`Spring容器`在启动时会`加载并解析该xml文件`，然后将Bean装载到IOC容器中。
>2. 使用`@ComponentScan组件扫描注解`来扫描声明了`@Controller`、`@Service`、`@Repository`、`@Component`注解的类，在将这个类加载到IOC容器中。
>3. 使用`@Configuration注解`声明配置类，并使用`@Bean`注解实现Bean的定义，这种方式其实是`xml配置方式的演变`，是Spring迈入到无配置化时代的里程碑。
>4. 使用`@Import注解`，导入`配置类`或`普通的Bean`。
>5. 使用`FactoryBean工厂Bean`，动态构建一个`Bean实例`，`Spring Cloud OpenFeign`里面的`动态代理实现`就是使用`FactoryBean`实现的。
>6. 通过实现`ImportBeanDefinitionRegister接口`，可以动态注入`Bean实例`。这个在Spring Boot里面的`启动注解`有所使用。
>7. 实现`ImportSelector接口`动态批量的注入`配置类`或者`Bean对象`，这个在`Spring Boot的自动装配机制`中有所使用。

## Spring中`Bean`的生命周期

>#### 所谓`Bean的生命周期`是指Bean实例从创建到销毁的整个过程，而SpringBean的生命周期则完全由Spring-IOC容器控制并进行管理。
>
>#### SpringBean的作用域：
>
>1. `singleton` : 唯一 bean 实例，Spring 中的 bean 默认都是单例的。
>2. `prototype` : 每次请求都会创建一个新的 bean 实例。
>3. `request `: 每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP request 内有效。
>4. `session`: 每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP session 内有效。
>5. `application`： 为每一个ServletContext对象创建一个实例，即同一个应用共享一个Bean实例，仅在Web Spring应用程序上下文中使用。
>6. `websocket`:为每一个WebSocket对象创建一个Bean实例，仅在Web Spring应用程序上下文中使用。
>
>#### Spring为Bean生命周期的操作提供了支持，在配置文件中定义Bean时，可以使用`init-method`与`destroy-method`属性对Bean进行初始化和销毁。
>
>#### SpringBean的生命周期简要概括为四步：
>
>1. 实例化 Instantiation
>2. 属性赋值 Populate
>3. 初始化 Initialization
>4. 销毁 Destruction

## Spring-Beans`对象管理`

>#### Spring中一个对象称为一个`Bean实例`，其由Spring容器自动创建并管理。
>
>
>* ***com.mofany***
>
>
>  * entity`Student实体类`
>
>    ```java
>    package com.mofany.entity;
>    
>    import lombok.*;
>    
>    import java.io.Serializable;
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/21
>     * @description Student
>     */
>    @Setter //必须为实体写权限
>    public class Student implements Serializable {
>        private Integer id;
>        private String name;
>        private String sex;
>        private short age;
>    }
>    ```
>
>* `spring-beans.xml`两种对象创建方式`单例`与`原型`
>
>  ```xml
>  <?xml version="1.0" encoding="UTF-8"?>
>  <beans xmlns="http://www.springframework.org/schema/beans"
>         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>         xsi:schemaLocation="http://www.springframework.org/schema/beans
>         http://www.springframework.org/schema/beans/spring-beans.xsd">
>  
>  <!--  单例创建对象  -->
>      <bean id="student1" class="com.mofany.entity.Student" scope="singleton"/>
>  <!-- 原型创建对象 -->
>      <bean id="student2" class="com.mofany.entity.Student" scope="prototype"/>
>      
>  </beans>
>  ```
>
>  #### 单元测试
>
>  ```java
>  package com.mofany.test;
>  
>  import com.mofany.dao.TeacherDao;
>  import com.mofany.dao.impl.StudentDaoImpl;
>  import com.mofany.entity.Student;
>  import com.mofany.entity.Teacher;
>  import org.junit.Test;
>  import org.springframework.context.ApplicationContext;
>  import org.springframework.context.support.ClassPathXmlApplicationContext;
>  
>  /**
>   * @author MoFany-J
>   * @date 2022/12/21
>   * @description StudentDaoImplTest
>   */
>  public class StudentDaoImplTest {
>  
>      /**
>       * bean的基本作用域
>       * */
>      @Test
>      public void test1(){
>          //加载类路径下指定的xml文件
>          ApplicationContext applicationContext=
>              new ClassPathXmlApplicationContext("spring-beans.xml");
>          
>          System.out.println("-----------------单例模式（复用同一对象）-------------------");
>          //获取单例bean实例
>          var obj1=applicationContext.getBean("student1", Student.class);
>          System.out.println(obj1);
>          obj1=applicationContext.getBean("student1", Student.class);
>          System.out.println(obj1);
>          obj1=applicationContext.getBean("student1", Student.class);
>          System.out.println(obj1);
>          
>          System.out.println("-----------------原型模式（创建不同对象）-------------------");
>          //获取原型bean实例
>          var obj2=applicationContext.getBean("student2", Student.class);
>          System.out.println(obj2);
>          obj2=applicationContext.getBean("student2", Student.class);
>          System.out.println(obj2);
>          obj2=applicationContext.getBean("student2", Student.class);
>          System.out.println(obj2);
>      }
>  }
>  ```
>
>  * 测试结果
>
>    ```properties
>    -----------------单例模式（复用同一对象）-------------------
>    com.mofany.entity.Student@7188af83
>    com.mofany.entity.Student@7188af83
>    com.mofany.entity.Student@7188af83
>    -----------------原型模式（创建不同对象）-------------------
>    com.mofany.entity.Student@7c37508a
>    com.mofany.entity.Student@247310d0
>    com.mofany.entity.Student@1033576a
>    
>    Process finished with exit code 0
>    ```
>
## Spring-`先控制反转`-`后基于构造器依赖注入`
>#### `IOC`所谓控制反转，即把创建对象的主动权的交给Spring-IOC容器。
>
>#### Spring-IOC`控制反转`：先利用Spring容器自动创建对象，而创建对象的这个过程称为控制反转。
>
>#### Spring-DI`依赖注入`：后给创建的对象属性赋值，给Spring容器创建的对象赋值的过程称为依赖注入。
>
>
>* ***com.mofany***
>
>
>  * entity`Teacher实体类`
>
>    ```java
>    package com.mofany.entity;
>    
>    import lombok.*;
>    
>    import java.io.Serializable;
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/21
>     * @description Teacher
>     */
>    @ToString
>    @AllArgsConstructor //必须提供全参数构造器
>    public class Teacher implements Serializable {
>        private Integer jobnum;
>        private String name;
>        private String sex;
>        private String subject;
>    }
>    ```
>
>  * util`自定义Bean的初始化工厂：TeacherFactoryUtil.initTeacherFactory()`
>
>    ```java
>    package com.mofany.util;
>    
>    import com.mofany.entity.Teacher;
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/25
>     * @description TeacherFactoryUtil 
>     */
>    public class TeacherFactoryUtil {
>    
>        private static Teacher teacher = null;
>    
>        private TeacherFactoryUtil() {
>            throw new RuntimeException("禁止反射！");
>        }
>    
>        /**
>         * 自定义工厂初始化方法
>         * */
>        public static Teacher initTeacherFactory(Integer jobnum, String name, String sex, String subject) {
>            
>            /**
>             * 利用了单例双检查机制
>             */
>            if (teacher == null) {
>                synchronized (TeacherFactoryUtil.class) {
>                    if (teacher == null) {
>                        teacher = new Teacher(jobnum, name, sex, subject);
>                    }
>                }
>            }
>            return teacher;
>        }
>    }
>    ```
>
>* `spring-ioc.xml`利用Spring容器按需创建对象，即无需人为创建对象`反射原理`
>
>  ```xml
>  <?xml version="1.0" encoding="UTF-8"?>
>  <beans xmlns="http://www.springframework.org/schema/beans"
>         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>         xmlns:p="http://www.springframework.org/schema/p"
>         xmlns:c="http://www.springframework.org/schema/c"
>         xsi:schemaLocation="http://www.springframework.org/schema/beans
>         http://www.springframework.org/schema/beans/spring-beans.xsd">
>  
>  <!--  基于构造器的IOC控制反转后DI依赖注入  -->
>      <!--  按形参下标开始  -->
>      <bean id="teacher1" class="com.mofany.entity.Teacher">
>          <constructor-arg index="0" value="1"></constructor-arg>
>          <constructor-arg index="1" value="王老师"></constructor-arg>
>          <constructor-arg index="2" value="男"></constructor-arg>
>          <constructor-arg index="3" value="大学语文"></constructor-arg>
>      </bean>
>  
>      <!--  按形参类型  -->
>      <bean id="teacher2" class="com.mofany.entity.Teacher">
>          <constructor-arg type="java.lang.Integer" value="2"></constructor-arg>
>          <constructor-arg type="java.lang.String" value="李老师"></constructor-arg>
>          <constructor-arg type="java.lang.String" value="女"></constructor-arg>
>          <constructor-arg type="java.lang.String" value="大学历史"></constructor-arg>
>      </bean>
>  
>      <!--  按参数名  -->
>      <bean id="teacher3" class="com.mofany.entity.Teacher">
>          <constructor-arg name="jobnum" value="3"></constructor-arg>
>          <constructor-arg name="name" value="洪老师"></constructor-arg>
>          <constructor-arg name="sex" value="男"></constructor-arg>
>          <constructor-arg name="subject" value="大学体育"></constructor-arg>
>      </bean>
>  <!-- 引用其它bean：适用于构造器的参数是其他bean的实例时使用 -->
>  
>  
>      <!--  利用指定的工厂方法实例化bean ，按默认顺序依赖注入 -->
>      <bean id="teacher4" class="com.mofany.util.TeacherFactoryUtil" 
>            												factory-method="initTeacherFactory">
>          <constructor-arg value="4"/>
>          <constructor-arg value="蒋老师"/>
>          <constructor-arg value="男"/>
>          <constructor-arg value="大学物理"/>
>      </bean>
>  </beans>
>  ```
>
>  #### 单元测试
>
>  ```java
>  package com.mofany.test;
>  
>  import com.mofany.dao.TeacherDao;
>  import com.mofany.entity.Teacher;
>  import org.junit.Test;
>  import org.springframework.context.ApplicationContext;
>  import org.springframework.context.support.ClassPathXmlApplicationContext;
>  
>  /**
>   * @author MoFany-J
>   * @date 2022/12/21
>   * @description TeacherDaoImplTest
>   */
>  public class TeacherDaoImplTest {
>  
>      /**
>       * 手动依赖注入
>       * */
>      @Test
>      public void test2(){
>          //加载类路径下指定的xml文件
>          ApplicationContext applicationContext=
>              new ClassPathXmlApplicationContext("spring-ioc.xml");
>          
>          //构造器的依赖注入
>          var tea=applicationContext.getBean("teacher1", Teacher.class);
>          System.out.println(tea);
>          tea=applicationContext.getBean("teacher2", Teacher.class);
>          System.out.println(tea);
>          tea=applicationContext.getBean("teacher3", Teacher.class);
>          System.out.println(tea);
>          tea=applicationContext.getBean("teacher4", Teacher.class);
>          System.out.println(tea);
>      }
>  }
>  ```
>
>  * 测试结果
>
>    ```properties
>    Teacher(jobnum=1, name=王老师, sex=男, subject=大学语文)
>    Teacher(jobnum=2, name=李老师, sex=女, subject=大学历史)
>    Teacher(jobnum=3, name=洪老师, sex=男, subject=大学体育)
>    Teacher(jobnum=4, name=蒋老师, sex=男, subject=大学物理)
>    
>    Process finished with exit code 0
>    ```
>
## 基于setter方法的依赖注入

>* ***com.mofany***
>
>  * entity`Teacher实体类`
>
>    ```java
>    package com.mofany.entity;
>    
>    import lombok.*;
>    
>    import java.io.Serializable;
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/21
>     * @description Teacher
>     */
>    @Setter //必须提供settre方法
>    @ToString
>    public class Teacher implements Serializable {
>        private Integer jobnum;
>        private String name;
>        private String sex;
>        private String subject;
>    }
>    ```
>
>* `spring-di.xml`
>
>  ```xml
>  <?xml version="1.0" encoding="UTF-8"?>
>  <beans xmlns="http://www.springframework.org/schema/beans"
>         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>         xmlns:p="http://www.springframework.org/schema/p"
>         xmlns:c="http://www.springframework.org/schema/c"
>         xsi:schemaLocation="http://www.springframework.org/schema/beans
>         http://www.springframework.org/schema/beans/spring-beans.xsd">
>  
>  <!--  基于setter方法的IOC控制反转后DI依赖注入  -->
>  
>      <!-- p-namespace，p属性的使用，xmlns:p="http://www.springframework.org/schema/p" -->
>      <bean id="teacher5" class="com.mofany.entity.Teacher" p:jobnum="5" p:name="何老师" 
>            p:sex="男" p:subject="大学音乐"/>
>  
>      <!-- c-namespace，c属性的使用，xmlns:c="http://www.springframework.org/schema/c" -->
>      <bean id="teacher6" class="com.mofany.entity.Teacher" c:_0="6" c:_1="汪老师" 
>            c:_2="男" c:_3="大学相声"/>
>      
>      <bean id="teacher7" class="com.mofany.entity.Teacher">
>      	<property name="jobnum" value="7"/>
>          <property name="name" value="璐老师"/>
>          <property name="sex" value="女"/>
>          <property name="subject" value="大学政治"/>
>      </bean>
>  
>  </beans>
>  ```
>
>  #### 单元测试
>
>  ```java
>  package com.mofany.test;
>  
>  import com.mofany.dao.TeacherDao;
>  import com.mofany.entity.Teacher;
>  import org.junit.Test;
>  import org.springframework.context.ApplicationContext;
>  import org.springframework.context.support.ClassPathXmlApplicationContext;
>  
>  /**
>   * @author MoFany-J
>   * @date 2022/12/21
>   * @description TeacherDaoImplTest
>   */
>  public class TeacherDaoImplTest {
>  
>      /**
>       * 手动依赖注入
>       * */
>      @Test
>      public void test3(){
>          //加载类路径下指定的xml文件
>          ApplicationContext applicationContext=
>              new ClassPathXmlApplicationContext("spring-di.xml");
>          
>          //构造器的依赖注入
>          var tea=applicationContext.getBean("teacher5", Teacher.class);
>          System.out.println(tea);
>          tea=applicationContext.getBean("teacher6", Teacher.class);
>          System.out.println(tea);
>          tea=applicationContext.getBean("teacher7", Teacher.class);
>          System.out.println(tea);
>      }
>  }
>  ```
>
>  * 测试结果
>
>    ```properties
>    Teacher(jobnum=5, name=何老师, sex=男, subject=大学音乐)
>    Teacher(jobnum=6, name=汪老师, sex=男, subject=大学相声)
>    Teacher(jobnum=7, name=璐老师, sex=女, subject=大学政治)
>    
>    Process finished with exit code 0
>    ```

## Spring-Autowire`自动注入`

>
>* ***com.mofany***
>
>
>  * entity`Student实体类`
>
>    ```java
>    package com.mofany.entity;
>    
>    import lombok.*;
>    
>    import java.io.Serializable;
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/21
>     * @description Student
>     */
>    @Setter // 依赖注入需要setter方法
>    @ToString
>    public class Student implements Serializable {
>        private Integer id;
>        private String name;
>        private String sex;
>        private short age;
>    }
>    ```
>
>  * dao`StudentDao数据访问层接口`
>
>    ```java
>    package com.mofany.dao;
>    
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/21
>     * @description StudentDao
>     */
>    public interface StudentDao {
>        void print();
>    }
>    ```
>
>* impl`StudentDaoImpl接口实现类`
>
>  ```java
>  package com.mofany.dao.impl;
>  
>  import com.mofany.dao.StudentDao;
>  import com.mofany.entity.Student;
>  import lombok.AllArgsConstructor;
>  import lombok.NoArgsConstructor;
>  import lombok.Setter;
>  
>  /**
>   * @author MoFany-J
>   * @date 2022/12/26
>   * @description StudentDaoImpl
>   */
>  @Setter // setter方法必须提供否则无法对成员变量按名称、按类型自动注入
>  @NoArgsConstructor
>  @AllArgsConstructor // 全参数构造器也得提供否则无法进行对成员变量的按构造器自动注入
>  public class StudentDaoImpl implements StudentDao {
>      /**
>       * 给成员变量自动注入值，但需要提供setter方法
>       * 1.ByName按名称注入就是以成员变量名为id名，
>       *   从配置中寻找有没有id为student的bean实例（必须提供自动注入属性的setter方法）
>       * 2.ByType按类型注入则是按照成员变量的类型Student为匹配条件，
>       *   从配置中寻找Class为Student的bean实例（必须提供自动注入属性的setter方法，
>       *	 只能存在一个该类类型的bean实例否则抛异常）
>       * 3.construct按构造器注入则是按照成员变量的构造器进行匹配（必须提供全参数构造器，
>       *	 即可实现自动注入这样就无需提供setter方法）
>       * */
>      private Student student=null;
>  
>      @Override
>      public void print(){
>          System.out.println(student+"\n");
>      }
>  }
>  ```
>
>* `spring-autowire.xml 三种自动注入注入方式：`
>
>  ```xml
>  <?xml version="1.0" encoding="UTF-8"?>
>  <beans xmlns="http://www.springframework.org/schema/beans"
>         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>         xsi:schemaLocation="http://www.springframework.org/schema/beans
>         http://www.springframework.org/schema/beans/spring-beans.xsd">
>  
>      <!-- 三种自动注入 先控制反转成员变量的实例，后依赖注入成员变量的属性-->
>      <bean id="student" class="com.mofany.entity.Student">
>          <property name="id" value="001"/>
>          <property name="name" value="璐瑶"/>
>          <property name="sex" value="女"/>
>          <property name="age" value="22"/>
>      </bean>
>  
>      <!--  1：按需按名称id自动注入 (只找寻同名的bean进行注入，若同名冲突则启动时报错) -->
>      <!--  Bean name 'studentDaoImpl2' is already used in this <beans> element  -->
>      <bean id="studentDaoImpl1" class="com.mofany.dao.impl.StudentDaoImpl" autowire="byName"/>
>      
>      <!--  2：按需按类型class自动注入 (当前上下文只能存在所需的一个类型多余则报错) -->
>      <bean id="studentDaoImpl2" class="com.mofany.dao.impl.StudentDaoImpl" autowire="byType"/>
>      
>      <!--  3：按需按成员变量全参数构造器constructor自动注入  -->
>      <bean id="studentDaoImpl3" class="com.mofany.dao.impl.StudentDaoImpl" 
>            															autowire="constructor"/>
>  </beans>
>  ```
>
>  #### 单元测试
>
>  ```java
>  package com.mofany.test;
>  
>  import com.mofany.dao.impl.StudentDaoImpl;
>  import com.mofany.entity.Student;
>  import org.junit.Test;
>  import org.springframework.context.ApplicationContext;
>  import org.springframework.context.support.ClassPathXmlApplicationContext;
>  
>  /**
>   * @author MoFany-J
>   * @date 2022/12/21
>   * @description StudentDaoImplTest
>   */
>  public class StudentDaoImplTest {
>  
>      /**
>       * 自动依赖注入
>       * */
>      @Test
>      public void test4(){
>          ApplicationContext applicationContext=
>              new ClassPathXmlApplicationContext("spring-autowire.xml");
>          
>          //ByName：按名称自动注入
>          System.out.println("-------------------ByName：按名称自动注入（默认单例）--------------");
>          var stu=applicationContext.getBean("studentDaoImpl1", StudentDaoImpl.class);
>          System.out.println(stu);
>          stu.print();
>          
>          //ByType：按类型自动注入
>          System.out.println("-------------------ByType：按类型自动注入（默认单例）--------------");
>          stu=applicationContext.getBean("studentDaoImpl2", StudentDaoImpl.class);
>          System.out.println(stu);
>          stu.print();
>          
>          //ByConstruct：按构造器自动注入
>          System.out.println("-----------------ByConstruct：按构造器自动注入（默认单例）---------");
>          stu=applicationContext.getBean("studentDaoImpl3", StudentDaoImpl.class);
>          System.out.println(stu);
>          stu.print();
>      }
>  }
>  ```
>
>  * 测试结果
>
>    ```properties
>    -------------------ByName：按名称自动注入（默认单例）--------------
>    com.mofany.dao.impl.StudentDaoImpl@740fb309
>    Student(id=1, name=璐瑶, sex=女, age=22)
>    
>    -------------------ByType：按类型自动注入（默认单例）--------------
>    com.mofany.dao.impl.StudentDaoImpl@4d14b6c2
>    Student(id=1, name=璐瑶, sex=女, age=22)
>    
>    -------------------ByConstruct：按构造器自动注入（默认单例）--------------
>    com.mofany.dao.impl.StudentDaoImpl@7e990ed7
>    Student(id=1, name=璐瑶, sex=女, age=22)
>    
>    
>    Process finished with exit code 0
>    ```
>
## Spring-AOP`面向切面`之横向编程
> ##### `利用动态代理`在方法执行前后加入一些其它要操作的内容，比如事务的开启与事务的提交`粗粒度AOP`
>
>* ***com.mofany***
>
>  * advice
>
>    * MyBeforeAdvice`自定义前置通知`
>
>      ```java
>      package com.mofany.advice;
>      
>      import org.springframework.aop.MethodBeforeAdvice;
>      
>      import java.lang.reflect.Method;
>      
>      /**
>       * @author MoFany-J
>       * @date 2022/12/28
>       * @description BeforeAdvice 自定义前置通知
>       */
>      public class MyBeforeAdvice implements MethodBeforeAdvice {
>          @Override
>          public void before(Method method, Object[] args, Object target) throws Throwable {
>              System.out.println("------------我是前置通知------------");
>          }
>      }
>      ```
>
>    * MyAfterReturningAdvice`自定义后置返回通知`
>
>      ```java
>      package com.mofany.advice;
>      
>      import org.springframework.aop.AfterReturningAdvice;
>      
>      import java.lang.reflect.Method;
>      
>      /**
>       * @author MoFany-J
>       * @date 2022/12/28
>       * @description MyAfterReturningAdvice 自定义后置返回通知
>       */
>      public class MyAfterReturningAdvice implements AfterReturningAdvice {
>          @Override
>          public void afterReturning(Object returnValue, Method method, Object[] args, Object target) throws Throwable {
>              System.out.println("------------我是后置返回通知------------\n");
>          }
>      }
>      ```
>
>    * MyAroundAdvice`自定义环绕通知`
>
>      ```java
>      package com.mofany.advice;
>      
>      
>      import org.aopalliance.intercept.MethodInterceptor;
>      import org.aopalliance.intercept.MethodInvocation;
>      
>      /**
>       * @author MoFany-J
>       * @date 2022/12/27
>       * @description MyAroundAdvice 自定义环绕通知(方法拦截器)
>       */
>      public class MyAroundAdvice implements MethodInterceptor {
>      
>          @Override
>          public Object invoke(MethodInvocation invocation) throws Throwable {
>              System.out.println("\n===========开启事务===========");
>              Object result=invocation.proceed();
>              System.out.println("===========提交事务===========\n");
>              return result;
>          }
>      }
>      ```
>
>  * dao`TeacherDao数据访问层接口`
>
>    ```java
>    package com.mofany.dao;
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/26
>     * @description TeacherDao
>     */
>    public interface TeacherDao {
>        /**
>         * 增
>         * */
>        void testInsert();
>        /**
>         * 删
>         * */
>        void testDelete();
>        /**
>         * 改
>         * */
>        void testUpdate();
>        /**
>         * 查
>         * */
>        void testSelect();
>    }
>    ```
>
>    * impl`接口实现类`
>
>      ```java
>      package com.mofany.dao.impl;
>      
>      import com.mofany.dao.TeacherDao;
>      import com.mofany.entity.Teacher;
>      import org.springframework.beans.factory.annotation.Autowired;
>      import org.springframework.stereotype.Repository;
>      
>      /**
>       * @author MoFany-J
>       * @date 2022/12/26
>       * @description TeacherDaoImpl
>       */
>      @Repository("teacherDaoImpl")
>      public class TeacherDaoImpl implements TeacherDao {
>          
>          private Teacher teacher;
>          /**
>           * 构造器注入
>           * */
>          @Autowired
>          private TeacherDaoImpl(Teacher teacher){
>              this.teacher=teacher;
>          }
>      
>          /**
>           * 增
>           */
>          @Override
>          public void testInsert() {
>              System.out.println("test insert:"+teacher);
>          }
>      
>          /**
>           * 删
>           */
>          @Override
>          public void testDelete() {
>              teacher=new Teacher();
>              System.out.println("test delete:"+teacher);
>          }
>      
>          /**
>           * 改
>           */
>          @Override
>          public void testUpdate() {
>              teacher.setJobnum(2);
>              teacher.setName("王老师");
>              teacher.setSex("男");
>              teacher.setSubject("大学化学");
>              System.out.println("test update:"+teacher);
>          }
>      
>          /**
>           * 查
>           */
>          @Override
>          public void testSelect() {
>              System.out.println("test select:"+teacher);
>          }
>      }
>      ```
>
>  * entity`Teacher实体类`
>
>    ```java
>    package com.mofany.entity;
>    
>    import lombok.*;
>    
>    import java.io.Serializable;
>    
>    /**
>     * @author MoFany-J
>     * @date 2022/12/21
>     * @description Teacher
>     */
>    @Setter
>    @ToString
>    @NoArgsConstructor
>    public class Teacher implements Serializable {
>        private Integer jobnum;
>        private String name;
>        private String sex;
>        private String subject;
>    }
>    ```
>
>* `aop配置1：spring-aop1.xml`强制使用CGLib作为Aop的代理
>
>  ```xml
>  <?xml version="1.0" encoding="UTF-8"?>
>  <beans xmlns="http://www.springframework.org/schema/beans"
>         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>         xmlns:aop="http://www.springframework.org/schema/aop"
>         xmlns:context="http://www.springframework.org/schema/context"
>         xsi:schemaLocation="http://www.springframework.org/schema/beans
>         https://www.springframework.org/schema/beans/spring-beans.xsd
>         http://www.springframework.org/schema/aop
>         https://www.springframework.org/schema/aop/spring-aop.xsd
>         http://www.springframework.org/schema/context
>         https://www.springframework.org/schema/context/spring-context.xsd">
>      
>      <!-- 扫描dao包及其子包下的注解 -->
>      <context:component-scan base-package="com.mofany.dao"/>
>      <!--  按名字进行自动依赖注入  -->
>      <bean id="teacher" class="com.mofany.entity.Teacher">
>          <property name="jobnum" value="1"/>
>          <property name="name" value="李老师"/>
>          <property name="sex" value="女"/>
>          <property name="subject" value="大学音乐"/>
>      </bean>
>  
>      <!--  面向切面编程：jdk动态代理 ，SpringAOP默认使用标准的JDK动态代理作为AOP代理
>            jdk动态代理三要素 ：类加载器、接口数组、处理器
>      -->
>      <!--  目标  -->
>      <bean id="teacherDaoImpl" class="com.mofany.dao.impl.TeacherDaoImpl"/>
>      
>      <!--  前置通知  -->
>      <bean id="myBeforeAdvice" class="com.mofany.advice.MyBeforeAdvice"/>
>      <!--  后置返回通知  -->
>      <bean id="myAfterReturningAdvice" class="com.mofany.advice.MyAfterReturningAdvice"/>
>      <!--  环绕通知  -->
>      <bean id="myAroundAdvice" class="com.mofany.advice.MyAroundAdvice"/>
>  
>      <!--  代理（填充代理三要素）  -->
>      <bean id="teacherDao" class="org.springframework.aop.framework.ProxyFactoryBean">
>          <!--  目标（target）  -->
>          <property name="target" ref="teacherDaoImpl"/>
>          <!--  接口数组（interfaces）  -->
>          <property name="interfaces" value="com.mofany.dao.TeacherDao"/>
>          <!--  处理器（Handler）  -->
>          <property name="interceptorNames">
>              <list>
>                  <!--  指定通知  -->
>                  <value>myBeforeAdvice</value>
>                  <value>myAfterReturningAdvice</value>
>                  <value>myAroundAdvice</value>
>              </list>
>          </property>
>      </bean>
>  
>      <!--  面向切面编程：可以强制使用CGLib作为AOP代理  -->
>      <aop:aspectj-autoproxy proxy-target-class="true"/>
>      <aop:config proxy-target-class="true"/>
>  
>  </beans>
>  ```
>
>  #### `配置1`单元测试：
>
>  ```java
>  package com.mofany.test;
>  
>  import com.mofany.dao.TeacherDao;
>  import com.mofany.entity.Teacher;
>  import org.junit.Test;
>  import org.springframework.context.ApplicationContext;
>  import org.springframework.context.support.ClassPathXmlApplicationContext;
>  
>  /**
>   * @author MoFany-J
>   * @date 2022/12/21
>   * @description TeacherDaoImplTest
>   */
>  public class TeacherDaoImplTest {
>  
>  
>      /**
>       * Spring-AOP：默认配置法（不带顾问）
>       * */
>      @Test
>      public void test5(){
>          ApplicationContext applicationContext=
>              new ClassPathXmlApplicationContext("spring-aop1.xml");
>          //获取代理对象
>          var obj1=applicationContext.getBean("teacherDao",TeacherDao.class);
>          obj1.testInsert();
>          obj1.testDelete();
>          obj1.testUpdate();
>          obj1.testSelect();
>      }
>  }
>  ```
>
>  * 测试结果
>
>    ```properties
>    ------------我是前置通知------------
>    
>    ===========开启事务===========
>    test insert:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    ===========提交事务===========
>    
>    ------------我是后置返回通知------------
>    
>    ------------我是前置通知------------
>    
>    ===========开启事务===========
>    test delete:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    ===========提交事务===========
>    
>    ------------我是后置返回通知------------
>    
>    ------------我是前置通知------------
>    
>    ===========开启事务===========
>    test update:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    ===========提交事务===========
>    
>    ------------我是后置返回通知------------
>    
>    ------------我是前置通知------------
>    
>    ===========开启事务===========
>    test select:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    ===========提交事务===========
>    
>    ------------我是后置返回通知------------
>    
>    
>    Process finished with exit code 0
>    ```
>
>
>
>------
>
>
>
>
>* `aop配置2：spring-aop2.xml`引入`顾问adviser`
>
>  ```xml
>  <?xml version="1.0" encoding="UTF-8"?>
>  <beans xmlns="http://www.springframework.org/schema/beans"
>         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>         xmlns:context="http://www.springframework.org/schema/context"
>         xsi:schemaLocation="http://www.springframework.org/schema/beans 					        	   http://www.springframework.org/schema/beans/spring-beans.xsd 			       			   http://www.springframework.org/schema/context 						   					   https://www.springframework.org/schema/context/spring-context.xsd">
>  
>      <!-- 扫描dao包及其子包下的注解 -->
>      <context:component-scan base-package="com.mofany.dao"/>
>      <!--  控制反转并依赖注入  -->
>      <bean id="teacher" class="com.mofany.entity.Teacher">
>          <property name="jobnum" value="1"/>
>          <property name="name" value="李老师"/>
>          <property name="sex" value="女"/>
>          <property name="subject" value="大学音乐"/>
>      </bean>
>  
>      <!--  目标  -->
>      <bean id="teacherDaoImpl" class="com.mofany.dao.impl.TeacherDaoImpl"/>
>      <!--  前置通知  -->
>      <bean id="myBeforeAdvice" class="com.mofany.advice.MyBeforeAdvice"/>
>      <!--  后置返回通知  -->
>      <bean id="myAfterReturningAdvice" class="com.mofany.advice.MyAfterReturningAdvice"/>
>      <!--  环绕通知  -->
>      <bean id="myAroundAdvice" class="com.mofany.advice.MyAroundAdvice"/>
>  
>      <!--  给代理指定顾问  -->
>      <bean id="teacherDao" class="org.springframework.aop.framework.ProxyFactoryBean">
>          <!--  目标（target）  -->
>          <property name="target" ref="teacherDaoImpl"/>
>          <!--  接口数组（interfaces）  -->
>          <property name="interfaces" value="com.mofany.dao.TeacherDao"/>
>          <!--  处理器（Handler）  -->
>          <property name="interceptorNames">
>              <list>
>                  <!--  指定顾问名  -->
>                  <value>myAdviser</value>
>              </list>
>          </property>
>      </bean>
>  
>      <!--  顾问：方法名称匹配顾问 （多种情况就得使用多个顾问） -->
>      <bean id="myAdviser" 
>          			class="org.springframework.aop.support.NameMatchMethodPointcutAdvisor">
>          <!--  指定环绕通知  -->
>          <property name="advice" ref="myAroundAdvice"/>
>          <!--  方法名称匹配：其可以使用正则表达式  -->
>          <property name="mappedNames">
>              <list>
>                  <!--  方法名筛选  -->
>                  <value>*Insert</value>
>                  <value>*Delete</value>
>                  <value>*Update</value>
>              </list>
>          </property>
>      </bean>
>  
>  </beans>
>  ```
>
>  ####  `配置2`单元测试：
>
>  ```java
>  package com.mofany.test;
>  
>  import com.mofany.dao.TeacherDao;
>  import com.mofany.entity.Teacher;
>  import org.junit.Test;
>  import org.springframework.context.ApplicationContext;
>  import org.springframework.context.support.ClassPathXmlApplicationContext;
>  
>  /**
>   * @author MoFany-J
>   * @date 2022/12/21
>   * @description TeacherDaoImplTest
>   */
>  public class TeacherDaoImplTest {
>  
>  
>      /**
>       * Spring-AOP：默认配置法（带顾问）
>       * */
>      @Test
>      public void test6(){
>          ApplicationContext applicationContext=
>              new ClassPathXmlApplicationContext("spring-aop2.xml");
>          //获取代理对象
>          var obj1=applicationContext.getBean("teacherDao",TeacherDao.class);
>          obj1.testInsert();
>          obj1.testDelete();
>          obj1.testUpdate();
>          obj1.testSelect();
>      }
>  }
>  ```
>
>  * 测试结果
>
>    ```properties
>    ===========开启事务===========
>    test insert:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    ===========提交事务===========
>    
>    
>    ===========开启事务===========
>    test delete:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    ===========提交事务===========
>    
>    
>    ===========开启事务===========
>    test update:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    ===========提交事务===========
>    
>    test select:Teacher(jobnum=1, name=李老师, sex=女, subject=大学音乐)
>    
>    Process finished with exit code 0
>    ```
>
>
## Spring-AspectJ`第三方面向切面编程`
>
>* ***com***
>
>  * **mofany**
>
>    * advice`自定义切面MyAspect`
>
>      ```java
>      package com.mofany.advice;
>      
>      import org.aspectj.lang.JoinPoint;
>      import org.aspectj.lang.ProceedingJoinPoint;
>      import org.aspectj.lang.annotation.*;
>      import org.springframework.context.annotation.EnableAspectJAutoProxy;
>      import org.springframework.stereotype.Component;
>      
>      /**
>       * @author MoFany-J
>       * @date 2022/12/26
>       * @description MyAspect 自定义切面
>       */
>      @Aspect
>      @Component
>      //注解启用自动代理
>      @EnableAspectJAutoProxy
>      public class MyAspect {
>          
>          /**
>           * 定义切入点的方法（也就是过滤并拦截指定包下的内容）
>           * */
>          @Pointcut("execution(* com.mofany.dao.*.*(..))")
>          private void myPointCut(){
>      
>          }
>      
>          /**
>           * 前置通知
>           * */
>          @Before("myPointCut()")
>          public void before(JoinPoint jp){
>              System.out.print("前置通知：模拟权限控制");
>              System.out.print("，目标类对象："+jp.getTarget());
>              System.out.println("，被增强处理的方法："+jp.getSignature().getName());
>          }
>      
>          /**
>           * 后置返回通知
>           * */
>          @AfterReturning("myPointCut()")
>          public void afterReturning(JoinPoint jp){
>              System.out.print("后置返回通知：模拟删除临时文件");
>              System.out.println("，被增强处理的方法："+jp.getSignature().getName());
>          }
>      
>          /**
>           * 环绕通知
>           * */
>          @Around("myPointCut()")
>          public Object around(ProceedingJoinPoint pjp)throws Throwable{
>              //事务开启
>              System.out.println("环绕开始：执行目标方法前，模拟开启事务");
>              //执行当前目标方法
>              Object obj=pjp.proceed();
>              //提交事务
>              System.out.println("环绕结束：执行目标方法后，模拟关闭事务");
>              return obj;
>          }
>      
>          /**
>           * 异常通知
>           * */
>          @AfterThrowing(value = "myPointCut()",throwing = "e")
>          public void except(Throwable e){
>              System.out.println("异常通知：程序执行异常"+e.getMessage());
>          }
>      
>          /**
>           * 后置最终通知
>           * */
>          @After("myPointCut()")
>          public void after(){
>              System.out.println("最终通知：模拟释放资源");
>          }
>      }
>      ```
>
>    * dao`数据访问层`
>
>      * `TeacherDao`
>
>        ```java
>        package com.mofany.dao;
>        
>        /**
>         * @author MoFany-J
>         * @date 2022/12/26
>         * @description TeacherDao
>         */
>        public interface TeacherDao {
>            /**
>             * 增
>             * */
>            void testInsert();
>            /**
>             * 删
>             * */
>            void testDelete();
>            /**
>             * 改
>             * */
>            void testUpdate();
>            /**
>             * 查
>             * */
>            void testSelect();
>        }
>        ```
>
>        * impl
>
>          * `TeacherDaoImpl`
>
>            ```java
>            package com.mofany.dao.impl;
>            
>            import com.mofany.dao.TeacherDao;
>            import com.mofany.entity.Teacher;
>            import org.springframework.beans.factory.annotation.Autowired;
>            import org.springframework.stereotype.Repository;
>            
>            /**
>             * @author MoFany-J
>             * @date 2022/12/26
>             * @description TeacherDaoImpl
>             */
>            @Repository("teacherDaoImpl")
>            public class TeacherDaoImpl implements TeacherDao {
>            
>                private Teacher teacher;
>                /**
>                 * 构造器注入
>                 * */
>                @Autowired
>                private TeacherDaoImpl(Teacher teacher){
>                    this.teacher=teacher;
>                }
>            
>                /**
>                 * 增
>                 */
>                @Override
>                public void testInsert() {
>                    teacher.setJobnum(1);
>                    teacher.setName("李老师");
>                    teacher.setSex("女");
>                    teacher.setSubject("大学舞蹈");
>                    System.out.println("test insert:"+teacher);
>                }
>            
>                /**
>                 * 删
>                 */
>                @Override
>                public void testDelete() {
>                    teacher=new Teacher();
>                    System.out.println("test delete:"+teacher);
>                }
>            
>                /**
>                 * 改
>                 */
>                @Override
>                public void testUpdate() {
>                    teacher.setJobnum(2);
>                    teacher.setName("王老师");
>                    teacher.setSex("男");
>                    teacher.setSubject("大学化学");
>                    System.out.println("test update:"+teacher);
>                }
>            
>                /**
>                 * 查
>                 */
>                @Override
>                public void testSelect() {
>                    System.out.println("test select:"+teacher);
>                }
>            }
>            ```
>
>    * entity`Teacher实体类`
>
>      ```java
>      package com.mofany.entity;
>      
>      import lombok.*;
>      
>      import java.io.Serializable;
>      
>      /**
>       * @author MoFany-J
>       * @date 2022/12/21
>       * @description Teacher
>       */
>      @Setter
>      @ToString
>      @Component
>      public class Teacher implements Serializable {
>          private Integer jobnum;
>          private String name;
>          private String sex;
>          private String subject;
>      }
>      ```
>
>  * **resources**
>
>    * `spring-aspectj-aop.xml`
>
>      ```xml
>      <?xml version="1.0" encoding="UTF-8"?>
>      <beans xmlns="http://www.springframework.org/schema/beans"
>             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>             xmlns:context="http://www.springframework.org/schema/context"
>             xmlns:aop="http://www.springframework.org/schema/aop"
>             xsi:schemaLocation="http://www.springframework.org/schema/beans
>             http://www.springframework.org/schema/beans/spring-beans.xsd
>             http://www.springframework.org/schema/context
>             https://www.springframework.org/schema/context/spring-context.xsd
>             http://www.springframework.org/schema/aop
>             https://www.springframework.org/schema/aop/spring-aop.xsd">
>      
>          <!--  组件扫描  -->
>          <context:component-scan base-package="com.mofany"/>
>          
>          <!--  启动自动代理支持（一种配置另外一种是注解@EnableAspectJAutoProxy）  -->
>          <!--  <aop:aspectj-autoproxy/>  -->
>      </beans>
>      ```
>
>#### 单元测试
>
>```java
>package com.mofany.test;
>
>import com.mofany.dao.TeacherDao;
>import com.mofany.entity.Teacher;
>import org.junit.Test;
>import org.springframework.context.ApplicationContext;
>import org.springframework.context.support.ClassPathXmlApplicationContext;
>
>/**
> * @author MoFany-J
> * @date 2022/12/21
> * @description TeacherDaoImplTest
> */
>public class TeacherDaoImplTest {
>
>    /**
>     * Spring-AOP：第三方
>     * */
>    @Test
>    public void test7(){
>        ApplicationContext applicationContext=
>            new ClassPathXmlApplicationContext("spring-aspectj-aop.xml");
>        
>        //获取代理对象
>        var obj1=applicationContext.getBean("teacherDaoImpl", TeacherDao.class);
>        obj1.testInsert();
>        System.out.println("===============================");
>        obj1.testDelete();
>        System.out.println("===============================");
>        obj1.testUpdate();
>        System.out.println("===============================");
>        obj1.testSelect();
>    }
>}
>```
>
>* 测试结果
>
>  ```properties
>  环绕开始：执行目标方法前，模拟开启事务
>  前置通知：模拟权限控制，目标类对象：com.mofany.dao.impl.TeacherDaoImpl@4795ded0，被增强处理的方法：testInsert
>  test insert:Teacher(jobnum=1, name=李老师, sex=女, subject=大学舞蹈)
>  后置返回通知：模拟删除临时文件，被增强处理的方法：testInsert
>  最终通知：模拟释放资源
>  环绕结束：执行目标方法后，模拟关闭事务
>  ===============================
>  环绕开始：执行目标方法前，模拟开启事务
>  前置通知：模拟权限控制，目标类对象：com.mofany.dao.impl.TeacherDaoImpl@4795ded0，被增强处理的方法：testDelete
>  test delete:Teacher(jobnum=null, name=null, sex=null, subject=null)
>  后置返回通知：模拟删除临时文件，被增强处理的方法：testDelete
>  最终通知：模拟释放资源
>  环绕结束：执行目标方法后，模拟关闭事务
>  ===============================
>  环绕开始：执行目标方法前，模拟开启事务
>  前置通知：模拟权限控制，目标类对象：com.mofany.dao.impl.TeacherDaoImpl@4795ded0，被增强处理的方法：testUpdate
>  test update:Teacher(jobnum=2, name=王老师, sex=男, subject=大学化学)
>  后置返回通知：模拟删除临时文件，被增强处理的方法：testUpdate
>  最终通知：模拟释放资源
>  环绕结束：执行目标方法后，模拟关闭事务
>  ===============================
>  环绕开始：执行目标方法前，模拟开启事务
>  前置通知：模拟权限控制，目标类对象：com.mofany.dao.impl.TeacherDaoImpl@4795ded0，被增强处理的方法：testSelect
>  test select:Teacher(jobnum=2, name=王老师, sex=男, subject=大学化学)
>  后置返回通知：模拟删除临时文件，被增强处理的方法：testSelect
>  最终通知：模拟释放资源
>  环绕结束：执行目标方法后，模拟关闭事务
>  
>  Process finished with exit code 0
>  ```
>